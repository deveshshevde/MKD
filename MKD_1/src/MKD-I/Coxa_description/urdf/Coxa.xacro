<?xml version="1.0"?>
<robot name="Coxa" xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- Include materials and Gazebo/ros2_control configs -->
  <xacro:include filename="$(find Coxa_description)/urdf/materials.xacro"/>
  <xacro:include filename="$(find Coxa_description)/urdf/Coxa.ros2control"/>
  <xacro:include filename="$(find Coxa_description)/urdf/Coxa.gazebo"/>

  <!-- Base Link -->
  <link name="base_link">
    <inertial>
      <origin xyz="0.00033395797201671865 0.0013978104325039146 0" rpy="0 0 0"/>
      <mass value="0.06279928162174031"/>
      <inertia ixx="4e-06" iyy="4e-06" izz="7e-06" ixy="-0.0" iyz="0.0" ixz="0.0"/>
    </inertial>
    <visual>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file://$(find Coxa_description)/meshes/base_link.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file://$(find Coxa_description)/meshes/base_link.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>

  <!-- Limb 1 -->
  <link name="limb1_1">
    <inertial>
      <origin xyz="0.02456704333623103 -0.01900167964714745 0.0018942146734706147" rpy="0 0 0"/>
      <mass value="0.0912840056163354"/>
      <inertia ixx="1.2e-05" iyy="1e-05" izz="1.4e-05" ixy="0.0" iyz="0.0" ixz="-1e-06"/>
    </inertial>
    <visual>
      <origin xyz="-0.00525 -0.01595 0.0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file://$(find Coxa_description)/meshes/limb1_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <origin xyz="-0.00525 -0.01595 0.0" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file://$(find Coxa_description)/meshes/limb1_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>

  <!-- Limb 2 -->
  <link name="limb2_1">
    <inertial>
      <origin xyz="0.016267862552212006 -0.020821914547370687 -0.014559695798222479" rpy="0 0 0"/>
      <mass value="0.057466860924570075"/>
      <inertia ixx="2.1e-05" iyy="1.8e-05" izz="1.5e-05" ixy="6e-06" iyz="0.0" ixz="-0.0"/>
    </inertial>
    <visual>
      <origin xyz="-0.03275 0.009 -0.01975" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file://$(find Coxa_description)/meshes/limb2_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <origin xyz="-0.03275 0.009 -0.01975" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file://$(find Coxa_description)/meshes/limb2_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>

  <!-- Limb 3 -->
  <link name="limb3_1">
    <inertial>
      <origin xyz="-0.010123326959735314 -0.008252080320144017 -0.018718035134085577" rpy="0 0 0"/>
      <mass value="0.1027240463508287"/>
      <inertia ixx="1.9e-05" iyy="3.3e-05" izz="4.4e-05" ixy="-1.8e-05" iyz="-1e-06" ixz="-1e-06"/>
    </inertial>
    <visual>
      <origin xyz="-0.066611 0.052341 -0.02275" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file://$(find Coxa_description)/meshes/limb3_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="silver"/>
    </visual>
    <collision>
      <origin xyz="-0.066611 0.052341 -0.02275" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file://$(find Coxa_description)/meshes/limb3_1.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
  </link>

  <!-- Joints -->
  <joint name="limb1_to_base" type="continuous">
    <origin xyz="0.00525 0.01595 0.0" rpy="0 0 0"/>
    <parent link="base_link"/>
    <child link="limb1_1"/>
    <axis xyz="0 1 0"/>
  </joint>

  <joint name="limb2_to_limb1" type="continuous">
    <origin xyz="0.0275 -0.02495 0.01975" rpy="0 0 0"/>
    <parent link="limb1_1"/>
    <child link="limb2_1"/>
    <axis xyz="0 0 1"/>
  </joint>

  <joint name="limb3_to_limb2" type="continuous">
    <origin xyz="0.033861 -0.043341 0.003" rpy="0 0 0"/>
    <parent link="limb2_1"/>
    <child link="limb3_1"/>
    <axis xyz="0 0 1"/>
  </joint>

  <!-- Transmissions -->
  <transmission name="limb1_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="limb1_to_base">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="servo1">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="limb2_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="limb2_to_limb1">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="servo2">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <transmission name="limb3_trans">
    <type>transmission_interface/SimpleTransmission</type>
    <joint name="limb3_to_limb2">
      <hardwareInterface>PositionJointInterface</hardwareInterface>
    </joint>
    <actuator name="servo3">
      <mechanicalReduction>1</mechanicalReduction>
    </actuator>
  </transmission>

  <!-- Gazebo plugin -->
  <gazebo>
    <plugin filename="libgz_ros2_control-system.so" 
            name="gz_ros2_control::GazeboSimROS2ControlPlugin">
      <robotNamespace>/</robotNamespace>
      <parameters>$(find Coxa_description)/config/controls.yaml</parameters>
    </plugin>
  </gazebo>

  <!-- ROS2 Control -->
  <ros2_control name="Coxa_hw" type="system">
    <hardware>
      <plugin>gazebo_ros2_control::DefaultRobotHWSim</plugin>
    </hardware>
    <joint name="limb1_to_base">
      <command_interface name="position"/>
      <state_interface name="position"/>
    </joint>
    <joint name="limb2_to_limb1">
      <command_interface name="position"/>
      <state_interface name="position"/>
    </joint>
    <joint name="limb3_to_limb2">
      <command_interface name="position"/>
      <state_interface name="position"/>
    </joint>
  </ros2_control>


</robot>
